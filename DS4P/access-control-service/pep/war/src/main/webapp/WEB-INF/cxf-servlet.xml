<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jaxws="http://cxf.apache.org/jaxws"
	xmlns:soap="http://cxf.apache.org/bindings/soap" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="
         http://www.springframework.org/schema/beans 
         http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
         http://cxf.apache.org/jaxws
         http://cxf.apache.org/schemas/jaxws.xsd
         http://www.springframework.org/schema/util
         http://www.springframework.org/schema/util/spring-util-3.0.xsd"
	default-lazy-init="true" default-init-method="afterPropertiesSet">

	<!-- Import statement optional but often required if you're declaring other 
		CXF beans in this file such as CXF's JMX MBeans -->
	<import resource="classpath:META-INF/cxf/cxf.xml" />

	<util:properties id="endpointAddressProperties"
		location="/WEB-INF/endpointAddress.properties" />
	<util:properties id="parameterConfigProperties"
		location="/WEB-INF/parameterConfig.Properties" />

	<!-- End points -->
	<jaxws:endpoint id="PepService" implementor="#pepPortTypeImpl"
		wsdlLocation="classpath:Pep.wsdl" address="/PepService">
		<jaxws:properties>
			<entry key="mtom-enabled" value="true" />
		</jaxws:properties>
	</jaxws:endpoint>

	<jaxws:endpoint id="filterc32service" implementor="#filterC32ServiceImpl"
		wsdlLocation="classpath:FilterC32Service.wsdl" address="/filterc32service">
		<jaxws:properties>
			<entry key="mtom-enabled" value="true" />
		</jaxws:properties>
	</jaxws:endpoint>
	
    <!--
	<jaxws:endpoint id="securedfilterc32service"
		implementor="#securedfilterC32ServiceImpl" wsdlLocation="classpath:SecuredFilterC32Service.wsdl"
		address="/securedfilterc32service">
		<jaxws:properties>
          <entry key="ws-security.signature.properties" value="crypto.properties"/>
           <entry key="ws-security.callback-handler" value="gov.samhsa.ds4ppilot.pep.ws.ServerPasswordCallback"/>
        </jaxws:properties>
	</jaxws:endpoint>		
    
	<jaxws:endpoint id="pushfilterc32service" implementor="#pushfilterC32ServiceImpl"
		wsdlLocation="classpath:PushFilterC32Service.wsdl" address="/pushfilterc32service">
		<jaxws:properties>
			<entry key="mtom-enabled" value="true" />
		</jaxws:properties>
	</jaxws:endpoint>
    -->
    
	<jaxws:endpoint id="xdsdocumentservice" implementor="#XDSDocumentServiceImpl"
		wsdlLocation="classpath:XDSDocumentService.wsdl" address="/xdsdocumentservice">
	</jaxws:endpoint>

	<!-- Old beans -->
	<!--  WSS4JInInterceptor for decrypting and validating the signature of inbound SOAP -->
    <!-- <bean id="inbound-security" class="org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor">
        <constructor-arg>
            <map>
                <entry key="action" value="Timestamp Signature Encrypt"/>
                <entry key="signaturePropFile" value="crypto.properties"/>
                <entry key="decryptionPropFile" value="crypto.properties"/>
                <entry key="passwordCallbackClass" value="gov.samhsa.ds4ppilot.pep.ws.ServerPasswordCallback"/>
            </map>
        </constructor-arg>
    </bean> -->

	<bean id="XDSDocumentServiceImpl"
		class="gov.samhsa.ds4ppilot.pep.ws.XDSDocumentServiceImpl"
		scope="prototype" autowire="byType" />

	<bean id="filterC32ServiceImpl"
		class="gov.samhsa.ds4ppilot.pep.ws.FilterC32ServiceImpl"
		scope="prototype" autowire="byType" />

	<bean id="securedfilterC32ServiceImpl"
		class="gov.samhsa.ds4ppilot.pep.ws.SecuredFilterC32ServiceImpl"
		scope="prototype" autowire="byType" />

	<bean id="pushfilterC32ServiceImpl"
		class="gov.samhsa.ds4ppilot.pep.ws.PushFilterC32ServiceImpl"
		scope="prototype" autowire="byType" />

	<bean id="pepImpl" class="gov.samhsa.ds4ppilot.pep.PepImpl"
		scope="prototype">
		<constructor-arg ref="c32GetterImpl" />
		<constructor-arg ref="contextHandlerImpl" />
		<constructor-arg ref="documentSegmentationImpl" />
		<constructor-arg ref="dataHandlerToBytesConverterImpl" />
		<constructor-arg ref="xdsbRepositoryImpl" />
		<constructor-arg ref="xdsbRegistryImpl" />
		<property name="subjectPurposeOfUse"
			value="#{parameterConfigProperties.subjectPurposeOfUse}" />
		<property name="subjectLocality" value="#{parameterConfigProperties.subjectLocality}" />
		<property name="organization" value="#{parameterConfigProperties.organization}" />
		<property name="organizationId" value="#{parameterConfigProperties.organizationId}" />
		<property name="resourceName" value="#{parameterConfigProperties.resourceName}" />
		<property name="resourceType" value="#{parameterConfigProperties.resourceType}" />
		<property name="resourceAction" value="#{parameterConfigProperties.resourceAction}" />
	</bean>

	<bean id="securedPepImpl"
		class="gov.samhsa.ds4ppilot.pep.SecuredPepImpl"
		scope="prototype">
		<constructor-arg ref="c32GetterImpl" />
		<constructor-arg ref="contextHandlerImpl" />
		<constructor-arg ref="documentSegmentationImpl" />
		<constructor-arg ref="dataHandlerToBytesConverterImpl" />
		<constructor-arg ref="xdsbRepositoryImpl" />
		<constructor-arg ref="xdsbRegistryImpl" />
		<constructor-arg ref="auditServiceImpl"/>
		<property name="subjectPurposeOfUse"
			value="#{parameterConfigProperties.subjectPurposeOfUse}" />
		<property name="subjectLocality" value="#{parameterConfigProperties.subjectLocality}" />
		<property name="organization" value="#{parameterConfigProperties.organization}" />
		<property name="organizationId" value="#{parameterConfigProperties.organizationId}" />
		<property name="resourceName" value="#{parameterConfigProperties.resourceName}" />
		<property name="resourceType" value="#{parameterConfigProperties.resourceType}" />
		<property name="resourceAction" value="#{parameterConfigProperties.resourceAction}" />
		<property name="homeCommunityId" value="#{parameterConfigProperties.homeCommunityId}" />
		<property name="repositoryUniqueId" value="#{parameterConfigProperties.repositoryUniqueId}" />
		<property name="subjectEmailAddress" value="#{parameterConfigProperties.subjectEmailAddress}" />
	</bean>

	<bean id="c32GetterImpl"
		class="gov.samhsa.ds4ppilot.pep.c32getter.C32GetterImpl"
		scope="prototype">
		<constructor-arg value="#{endpointAddressProperties.c32Service}" />
	</bean>
	
	<!-- New beans -->
	
	<!-- Common Tools -->
	<bean id="documentXmlConverterImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.common.tool.DocumentXmlConverterImpl"
		scope="prototype"/>
	<bean id="fileReaderImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.common.tool.FileReaderImpl"
		scope="prototype"/>
	<bean id="simpleMarshallerImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.common.tool.SimpleMarshallerImpl"
		scope="prototype" />
		
	<!-- XDS.b -->
	<!-- XDS.b: common -->
	<bean id="xdsbErrorFactory"
		class="gov.samhsa.consent2share.accesscontrolservice.xdsb.common.XdsbErrorFactory"
		scope="prototype">
	</bean>	
	<!-- XDS.b: clients -->
	<bean id="xdsbRegistryWebServiceClient"
		class="gov.samhsa.consent2share.accesscontrolservice.xdsb.registry.XdsbRegistryWebServiceClient"
		scope="prototype">
		<constructor-arg value="#{endpointAddressProperties.xdsbRegistry}" />
	</bean>
	<bean id="xdsbRepositorybWebServiceClient"
		class="gov.samhsa.consent2share.accesscontrolservice.xdsb.repository.XDSRepositorybWebServiceClient"
		scope="prototype">
		<constructor-arg value="#{endpointAddressProperties.xdsbRepository}" />
	</bean>
	<!-- XDS.b: adapters -->
	<bean id="adhocQueryResponseFilter"
		class="gov.samhsa.consent2share.accesscontrolservice.xdsb.registry.adapter.AdhocQueryResponseFilter"
		scope="prototype" autowire="constructor">
	</bean>
	<bean id="xdsbRegistryAdapter"
		class="gov.samhsa.consent2share.accesscontrolservice.xdsb.registry.adapter.XdsbRegistryAdapter"
		scope="prototype" autowire="constructor">
	</bean>
	<bean id="retrieveDocumentSetResponseFilter"
		class="gov.samhsa.consent2share.accesscontrolservice.xdsb.repository.adapter.RetrieveDocumentSetResponseFilter"
		scope="prototype" autowire="constructor">
	</bean>
	<bean id="xdsbRepositoryAdapter"
		class="gov.samhsa.consent2share.accesscontrolservice.xdsb.repository.adapter.XdsbRepositoryAdapter"
		scope="prototype" autowire="constructor">
	</bean>
	
	<bean id="xdsbRepositoryImpl"
		class="gov.samhsa.ds4ppilot.pep.xdsbrepository.XdsbRepositoryImpl"
		scope="prototype">
		<constructor-arg value="#{endpointAddressProperties.xdsbRepository}" />
	</bean>

	<bean id="xdsbRegistryImpl"
		class="gov.samhsa.ds4ppilot.pep.xdsbregistry.XdsbRegistryImpl"
		scope="prototype">
		<constructor-arg value="#{endpointAddressProperties.xdsbRegistry}" />
	</bean>
	
	<!-- PDP -->
	<!-- PDP: data - PolicyDecisionPointImplDataXdsb -->
	<bean id="policyDecisionPointImplDataXdsb"
		class="gov.samhsa.ds4ppilot.pep.contexthandler.PolicyDecisionPointImplDataXdsb"
		scope="prototype" autowire="constructor">
	</bean>
	
	<!-- Uncomment the following to Use PolicyDecisionPointImplDataJdbc instead of PolicyDecisionPointImplDataXdsb -->
	
	<!-- <bean id="policyDecisionPointImplData"
		class="gov.samhsa.ds4ppilot.pep.contexthandler.PolicyDecisionPointImplDataJdbc"
		scope="prototype" autowire="constructor">
	</bean>
	
	<bean id="dataSource" destroy-method="close" class="org.apache.commons.dbcp.BasicDataSource">
		<property name="driverClassName" value="com.mysql.jdbc.Driver" />
		<property name="url" value="jdbc:mysql://localhost:3306/consent2share?autoReconnect=true" />
		<property name="username" value="root" />
		<property name="password" value="admin" />
	</bean>
	
	<bean id="lobHandler" class="org.springframework.jdbc.support.lob.OracleLobHandler">
        <property name="nativeJdbcExtractor" ref="nativeJdbcExtractor"/>
    </bean>
    
    <bean id="nativeJdbcExtractor"
		class="org.springframework.jdbc.support.nativejdbc.C3P0NativeJdbcExtractor"
		lazy-init="true" /> -->
	
	<!-- PDP: request generator -->
	<bean id="requestGenerator"
		class="gov.samhsa.ds4ppilot.pep.contexthandler.RequestGenerator"
		scope="prototype">
	</bean>
	<!-- PDP: pdp -->
	<bean id="policyDecisionPointImpl"
		class="gov.samhsa.ds4ppilot.pep.contexthandler.PolicyDecisionPointImpl"
		scope="prototype" autowire="constructor">
	</bean>	
	
	<!-- ContextHandler -->
	<!-- ContextHandler: context handler -->
	<bean id="contextHandlerImpl"
		class="gov.samhsa.ds4ppilot.pep.contexthandler.ContextHandlerImpl"
		scope="prototype" autowire="constructor">
	</bean>
	
	<!-- BRMS -->
	<!-- BRMS: Guvnor -->
	<bean id="guvnorServiceImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.brms.guvnor.GuvnorServiceImpl"
		scope="prototype"> 
		<constructor-arg index="0" value="#{endpointAddressProperties.guvnorService}"  />
		<constructor-arg index="1" value="#{endpointAddressProperties.guvnorServiceUsername}"  />
		<constructor-arg index="2" value="#{endpointAddressProperties.guvnorServicePassword}"  />
	</bean>
	<bean id="ruleExecutionServiceImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.brms.service.RuleExecutionServiceImpl"
		scope="prototype" autowire="constructor" />
	
	<!-- DocumentSegmentation -->
	<!-- DocumentSegmentation: audit -->
	<bean id="auditServiceImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.documentsegmentation.audit.AuditServiceImpl"
		scope="prototype">
		<constructor-arg value="#{endpointAddressProperties.auditService}" />
	</bean>
	<!-- DocumentSegmentation: tools -->
	<bean id="documentEditorImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.documentsegmentation.tools.DocumentEditorImpl"
		scope="prototype" autowire="byType"/>
	<bean id="documentEncrypterImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.documentsegmentation.tools.DocumentEncrypterImpl"
		scope="prototype" autowire="byType"/>
	<bean id="documentMaskerImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.documentsegmentation.tools.DocumentMaskerImpl"
		scope="prototype" autowire="byType"/>
	<bean id="documentRedactorImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.documentsegmentation.tools.DocumentRedactorImpl"
		scope="prototype" autowire="byType"/>
	<bean id="documentTaggerImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.documentsegmentation.tools.DocumentTaggerImpl"
		scope="prototype"/>
	<bean id="metadataGeneratorImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.documentsegmentation.tools.MetadataGeneratorImpl"
		scope="prototype"/>
	<bean id="documentFactModelExtractorImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.documentsegmentation.tools.DocumentFactModelExtractorImpl"
		scope="prototype"/>
	<bean id="additionalMetadataGeneratorForSegmentedClinicalDocumentImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.documentsegmentation.tools.AdditionalMetadataGeneratorForSegmentedClinicalDocumentImpl"
		scope="prototype"/>
	<!-- DocumentSegmentation: document segmentation -->		
	<bean id="documentSegmentationImpl"
		class="gov.samhsa.consent2share.accesscontrolservice.documentsegmentation.DocumentSegmentationImpl"
		scope="prototype" autowire="constructor" />	
		
	<!-- PEP -->
	<!-- PEP: DataHandlerToBytesConverter -->	
	<bean id="dataHandlerToBytesConverterImpl"
		class="gov.samhsa.ds4ppilot.pep.DataHandlerToBytesConverterImpl"
		scope="prototype">
	</bean>
	
	<!-- PEP: pep -->
	<bean id="policyEnforcementPointImpl"
		class="gov.samhsa.ds4ppilot.pep.PolicyEnforcementPointImpl"
		scope="prototype" autowire="constructor">
		<property name="patientId" value="#{parameterConfigProperties.patientId}" />
		<property name="recepientSubjectNPI" value="#{parameterConfigProperties.recepientSubjectNPI}" />
		<property name="intermediarySubjectNPI" value="#{parameterConfigProperties.intermediarySubjectNPI}" />
		<property name="subjectPurposeOfUse" value="#{parameterConfigProperties.subjectPurposeOfUse}" />
		<property name="homeCommunityId" value="#{parameterConfigProperties.domainId}" />
	</bean>
	<!-- PEP: pep-ws -->
	<bean id="pepPortTypeImpl"
		class="gov.samhsa.ds4ppilot.pep.ws.PepPortTypeImpl"
		scope="prototype" autowire="constructor" />
		
</beans>